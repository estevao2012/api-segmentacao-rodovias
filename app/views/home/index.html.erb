<div id="map" class="map"></div>
<div id="information" class="information"></div>
<script type="text/javascript">

var base_layer = new ol.layer.Tile({ source: new ol.source.MapQuest({layer: 'osm'})})
var centeroid = ol.proj.transform([-47.1384275, -12.1923535], 'EPSG:4326', 'EPSG:3857');
var viewOverall = new ol.View({
    center: centeroid,
    zoom: 7
});

var map = new ol.Map({
  layers: [base_layer],
  target: 'map',
  view: viewOverall
});

map.getViewport().addEventListener("click", function(e) {
  var pixel   = map.getEventPixel(e);
  var feature = map.forEachFeatureAtPixel(pixel, function(feature, layer) {
    return feature;
  });

  var $info = $("#information");

  if (feature) {
    var br  = feature.get('br');
    var url = "/informacao-rodovia/" + br ;

    $.get(url, function(data){
      $info.html(data);
    });
  } else {
    $info.html('&nbsp;');
  }
});

map.addInteraction(new ol.interaction.Select({
  condition: ol.events.condition.mouseMove
}));

$(function(){
  <% @locals.each do |single| %>
    $.get("<%= get_geom_path(single.br) %>", function(data){
      var item = createVector("#<%= random_color %>", data);
      map.addLayer(item);
    });
  <% end %>
});

</script>